<html>
<head>
    <meta charset="UTF-8">
    <title>FourPawsCitizens</title>
    <link rel="stylesheet" href="CSS/Styles.css" type="text/css">
</head>
<body class="loginBack">

<div class="login" align="center">
    <form action="" method="get">
        <fieldset>
            <legend>Login</legend>
            <br>
            <label for="user">Usuario:</label> <br>
            <input type="text" name="user" id="user" required>
            <br><br>
            <label for="password">Contraseña:</label> <br>
            <input type="password" name="password" id="password" required>
            <br>
            <br>
            <button id="logButton" type="button" onclick= "findRole()">Ingresar</button>
        </fieldset>
    </form>
    <a type="button" href="singUp.html">Registrarse</a>
</div>
<script type="text/javascript">
    function findRole() {
        let url = 'http://localhost:8080/FourPawsCitizens-FootprintsSystem-1.0-SNAPSHOT/api/userApp';
        let username = document.getElementById("user").value;
        let password = document.getElementById("password").value;

        let headers = new Headers();

        headers.append('Content-Type', 'text/json');
        headers.append('Authorization', 'Basic ' + btoa(username + ":" + password));

        fetch(url, {
            method: 'GET',
            headers: headers,
        })
            .then(response => response.text())
            .then(response => redirect(response.toString()));

    }

    function redirect(role) {
        var rolhref=role+".html";
        if (role === "owner")
            role = "owners";
        if (role != "owner"&&role != "vet"&&role != "official"){
            alert("Contraseña o usuario erroneos. Intente de nuevo");
            location.reload();
        }else{
            let url = 'http://localhost:8080/FourPawsCitizens-FootprintsSystem-1.0-SNAPSHOT/api/' + role;

            let username = document.getElementById("user").value;
            let password = document.getElementById("password").value;
            let headers = new Headers();

            headers.append('Content-Type', 'text/json');
            headers.append('Authorization', 'Basic ' + btoa(username + ":" + password));

            fetch(url, {
                method: 'GET',
                headers: headers,
            }).then(response => response.ok).then(window.location.href= rolhref+"?"+username);
        }
    }
</script>
</body>
</html>