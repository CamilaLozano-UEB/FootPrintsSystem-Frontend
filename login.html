<html>
<head>
    <meta charset="UTF-8">
    <title>FourPawsCitizens</title>
    <link rel="stylesheet" href="CSS/Styles.css" type="text/css">
</head>
<body class="loginBack">

<div class="TitleInt">
    <h1 align="center">
        Ciudadanos de Cuatro Patas
    </h1>
    <h2 align="center">
        Bienvenidos
    </h2>
</div>
<!-- form for login to the program-->
<div class="login" align="center">
    <form action="" method="get">
        <fieldset>
            <legend align="center">Login</legend>
            <br>
            <label for="user">Usuario:</label> <br>
            <input type="text" name="user" id="user" required>
            <br><br>
            <label for="password">Contraseña:</label> <br>
            <input type="password" name="password" id="password" required>
            <br>
            <br>
            <button id="logButton" type="button" onclick="findRole()">Ingresar</button>
        </fieldset>
    </form>
    <a type="button" href="singUp.html">Registrarse</a>
</div>
<script type="text/javascript">
    /**
     * this function find the user and the password in the headers to autorize it
     */
    function findRole() {
        let url = 'http://localhost:8080/FourPawsCitizens-FootprintsSystem-1.0-SNAPSHOT/api/userApp';
        let username = document.getElementById("user").value;
        let password = document.getElementById("password").value;

        let headers = new Headers();

        headers.append('Content-Type', 'text/json');
        headers.append('Authorization', 'Basic ' + btoa(username + ":" + password));

        fetch(url, {
            method: 'GET',
            headers: headers,
        })
            .then(response => response.text())
            .then(response => redirect(response.toString()));

    }

    /**
     * This function take the role of the login, validates it and if its correct redirects to the tab corresponding to the user
     * @param role user's role
     */
    function redirect(role) {
        if (role != "owner" && role != "vet" && role != "official") {
            alert("Contraseña o usuario erroneos. Intente de nuevo");
            location.reload();

        } else {
            var rolhref = role + ".html";
            if (role === "owner")
                role = "owners";
            let url = 'http://localhost:8080/FourPawsCitizens-FootprintsSystem-1.0-SNAPSHOT/api/' + role;

            let username = document.getElementById("user").value;
            let password = document.getElementById("password").value;
            let headers = new Headers();

            headers.append('Content-Type', 'text/json');
            headers.append('Authorization', 'Basic ' + btoa(username + ":" + password));

            fetch(url, {
                method: 'GET',
                headers: headers,
            }).then(response => response.ok).then(window.location.href = rolhref + "?" + username);
        }
    }
</script>
</body>
</html>